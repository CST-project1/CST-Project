<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../bootstrap-5.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../styles/aside.css">
    <title>Product Info</title>
</head>

<body>
    <div class="container-fluid vh-100 d-flex p-0">
        <div id="sidebar-container"></div>

        <main class="flex-grow-1 p-3">
            <div class="container">
                <h2 class="mb-4" id="page-title">Product Information</h2>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Product Image</label>
                        <div class="border rounded p-3 text-center bg-white shadow-sm mb-3">
                            <img src="../../../images/images.jpeg" alt="Product" class="img-fluid rounded"
                                id="productImage">
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Product Name</label>
                            <p id="productName"></p>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Description</label>
                            <p id="productDescription"></p>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold">Price</label>
                                <p id="productPrice"></p>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold">Discount (%)</label>
                                <p id="productDiscount"></p>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold">Stock</label>
                                <p id="productStock"></p>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Category</label>
                            <p id="productCategory"></p>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Status</label>
                            <p id="productStatus"></p>
                        </div>
                    </div>
                </div>

                <!-- Store Information -->
                <div class="mt-5" id="storeInfo" style="display:none;">
                    <h4 class="mb-3">Store Information</h4>
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <p><strong>Store Name:</strong> <span id="storeName"></span></p>
                            <p><strong>Owner:</strong> <span id="storeSeller"></span></p>
                            <p><strong>Contact:</strong> <span id="storeContact"></span></p>
                            <p><strong>Email:</strong> <span id="storeEmail"></span></p>
                            <p><strong>Location:</strong> <span id="storeAddress"></span></p>
                            <a href="store-products.html" id="storeProductsLink" class="btn btn-outline-primary btn-sm">
                                View All Store Products
                            </a>
                        </div>
                    </div>
                </div>

                <div class="d-flex gap-2 mt-4">
                    <button type="button" class="btn btn-danger" id="deleteBtn">
                        <i class="fa-solid fa-trash me-2"></i> Delete Product
                    </button>
                    <a href="editProduct.html" class="btn btn-primary" id="editBtn">
                        <i class="fa-solid fa-pen me-2"></i> Edit Product
                    </a>
                </div>
            </div>
        </main>
    </div>

    <script>
        // جلب الـ id من الرابط
        const params = new URLSearchParams(window.location.search);
        const productId = params.get("id");

        // جلب المنتجات والمتاجر والمستخدمين من localStorage
        let products = JSON.parse(localStorage.getItem("products")) || [];
        let stores = JSON.parse(localStorage.getItem("stores")) || [];
        let users = JSON.parse(localStorage.getItem("users")) || [];

        // البحث عن المنتج
        const product = products.find(p => String(p.id) === String(productId));

        if (product) {
            document.getElementById("productImage").src = ("../../../images/" + product.image) ||
                "../../../images/images.jpeg";
            document.getElementById("productName").textContent = product.name;
            document.getElementById("productDescription").textContent = product.description || "No description";
            document.getElementById("productPrice").textContent = product.price + " EGP";
            document.getElementById("productDiscount").textContent = product.discount ? product.discount + "%" : "0%";
            document.getElementById("productStock").textContent = product.stock || 0;
            document.getElementById("productCategory").textContent = product.category || "N/A";
            document.getElementById("productStatus").textContent = product.status || "inactive";

            // تعديل رابط Edit Product مع الـ id
            document.getElementById("editBtn").href = `editProduct.html?id=${product.id}`;

            // البحث عن البائع حسب store_id
            const seller = users.find(u => u.role === "Seller" && u.store_id === product.store_id);

            if (seller) {
                document.getElementById("storeInfo").style.display = "block";
                document.getElementById("storeName").textContent = seller.name || "N/A";
                document.getElementById("storeSeller").textContent = seller.username || "N/A";
                document.getElementById("storeContact").textContent = seller.phone || "N/A";
                document.getElementById("storeEmail").textContent = seller.email || "N/A";

                // إذا موجودة بيانات عنوان في المتجر نفسه
                const store = stores.find(s => String(s.id) === String(product.store_id));
                document.getElementById("storeAddress").textContent = store ? store.location || "N/A" : "N/A";

                document.getElementById("storeProductsLink").href = `store-products.html?id=${product.store_id}`;
            }
        }

        // زر الحذف
        document.getElementById("deleteBtn").addEventListener("click", () => {
            if (confirm("Are you sure you want to delete this product?")) {
                products = products.filter(p => String(p.id) !== String(productId));
                localStorage.setItem("products", JSON.stringify(products));
                alert("Product deleted!");
                window.location.href = "products.html";
            }
        });
    </script>

    <script src="../../bootstrap-5.3.7-dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/aside.js"></script>
</body>

</html>